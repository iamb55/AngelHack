=co=content_for :head do
  = javascript_include_tag 'tokbox'
  = javascript_include_tag 'conversation_view'
  = javascript_include_tag "http://staging.tokbox.com/v0.91/js/TB.min.js"
  = stylesheet_link_tag "inbox.css"

#main
  .container_12
    .conversations
      .leftbar
        #newq.button New Question
        %h3 Mentor Responses
        .users
          %ul.list
            -if @conversations && !@conversations.empty?
              -@conversations.each do |conversation|
                %li.chatSelection
                  .user{"data-id" => "#{conversation[:id]}"}
                    %img.imagerounded{:src => "#{conversation[:user].picture_url}"}
                      .information
                        %h4= conversation[:user].first_name
                        -if conversation[:message][:data_type] == 'video'
                          %p video
                        -else
                          %p= truncate(conversation[:message][:value], length: 50)
                      .clear
          %h3 Pending Questions
          .users
            %ul.list
              %li.chatSelection
                .user{"data-id" => "11"}
                  %img.imagerounded{:src => "https://graph.facebook.com/550876882/picture?type=square"}
                    .information
                      %h4 How do I become a product designer?
                    .clear
      .rightbar
        #scroll.messages{"data-id" => "11"}
          -if @conversations && !@conversations.empty?
            %h2= truncate(@messages.first.value, length: 75)
            .messages#scroll{ data: { id: "#{@conversations[0][:id]}"} }
              %ul
                -@messages.each do |message| 
                  -owner = message.conversation.send(message.owner_type)
                  %li
                    -if message['data_type'] == 'text'
                      .container_12
                        .grid_1
                          %img.imagerounded{src: owner.picture_url}
                        .grid_5
                          %h5= owner.first_name
                        #timestamp.grid_2
                          = time_ago_in_words(message['created_at'])
                      .mentee.message
                        %p=message.value
                    -else
                      .container_12
                        .grid_1
                          %img.imagerounded{src: owner.picture_url}
                        .grid_5
                          %h5= owner.first_name
                        #timestamp.grid_2
                          = time_ago_in_words(message['created_at'])
                      .mentee.message
                        .videoPlayer{id: "#{message.value}", data: { id: "#{message.value}" } }
                          %div{id: "p#{message.value}"}
                          
          .replybar
            %p
              %textarea
              %br.clear/
              .rightf
                .button.reply.leftf
                  Add a Video
                #inboxr.button.reply.leftf
                  %span Send
              .clear
    .clear

#responseModal.reveal-modal
  %h1= 'Submit a Response'
  #recorderContainer
  <a class="close-reveal-modal">&#215;</a>
  
        
%script.text-message-template{ type: "text/x-handlebars-template" }
  %li
    .container_12
      .grid_1
        %img.imagerounded{src: "{{picture_url}}" }
      .grid_5
        %h5 {{ name }}
      .grid_2#timestamp  
        {{ created_at }}
    .message{class: "{{owner_type}}" }
      %p {{value}}

%script.video-message-template{ type: "text/x-handlebars-template" }
  %li
    .container_12
      .grid_1
        %img.imagerounded{src: "{{picture_url}}" }
      .grid_5
        %h5 {{ name }}
      .grid_2#timestamp  
        {{created_at}}
    .videoPlayer{id: "{{value}}", data: { id: "{{value}}" } }
      %div{id: "p{{value}}"}

